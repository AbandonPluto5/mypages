"use strict";(self["webpackChunklikede"]=self["webpackChunklikede"]||[]).push([[5],{7005:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-row",{staticClass:"search"},[t("el-col",{attrs:{span:24}},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"策略搜索："}},[t("el-input",{staticStyle:{width:"203px"},attrs:{placeholder:"请输入",size:"medium",clearable:""},model:{value:e.searchForm.policyName,callback:function(t){e.$set(e.searchForm,"policyName",t)},expression:"searchForm.policyName"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"80px"},attrs:{icon:"el-icon-search",size:"medium"},on:{click:function(t){return e.getPolicyList(e.searchForm)}}},[e._v("查询")])],1)],1)],1)],1),t("el-row",{staticClass:"list"},[t("el-col",{attrs:{span:24}},[t("el-row",{staticClass:"add"},[t("el-col",[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline"},on:{click:function(t){(e.type="add")&&(e.showDialog=!0)}}},[e._v("新建")])],1)],1),t("el-row",{staticClass:"table"},[t("el-col",[t("PMTable",{attrs:{tableData:e.policyList,loading:e.loading},on:{handlePreview:e.handlePreview,handleEdit:e.handleEdit,handleDelete:e.handleDelete,getPolicyList:function(t){return e.getPolicyList()}}})],1)],1),t("el-row",{staticClass:"page"},[t("el-col",{attrs:{span:20}},[t("span",[e._v("共"+e._s(e.page.totalCount)+"条记录  第 "+e._s(e.page.pageIndex)+"/"+e._s(e.page.totalPage)+" 页")])]),t("el-col",{attrs:{span:2}},[t("el-button",{class:{disable:1===e.page.pageIndex},attrs:{disabled:1===e.page.pageIndex},on:{click:function(t){(e.page.pageIndex>1?e.page.pageIndex--:e.page.pageIndex)&&e.getPolicyList()}}},[e._v("上一页")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{class:{disable:e.page.pageIndex===+e.page.totalPage},attrs:{disabled:e.page.pageIndex===+e.page.totalPage},on:{click:function(t){(e.page.pageIndex<e.page.totalPage?e.page.pageIndex++:e.page.pageIndex)&&e.getPolicyList()}}},[e._v("下一页")])],1)],1)],1)],1),t("PMDialog",{ref:"pmDialog",attrs:{visible:e.showDialog,type:e.type,currentRow:e.currentRow,loading1:e.loading1,policyList:e.policyList},on:{"update:visible":function(t){e.showDialog=t},"update:loading1":function(t){e.loading1=t}}})],1)},l=[],o=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"empty-text":"","cell-style":{padding:"2px 0",border:"none"},size:"small","header-cell-style":{background:"#f4f6fa"}}},[t("el-table-column",{attrs:{label:"序号",type:"index",index:1,width:"80"}}),t("el-table-column",{attrs:{label:"策略名称","min-width":"344",prop:"policyName"}}),t("el-table-column",{attrs:{label:"策略方案","min-width":"343",prop:"discount"}}),t("el-table-column",{attrs:{label:"创建日期","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.createTime.replace(/-/g,".").replace("T"," ")))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handlePreview(a.$index,a.row)}}},[e._v("查看详情")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("修改")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}},[e._v("删除")])]}}])})],1)},s=[],n=a(471);const p=e=>n.Z.get("/api/vm-service/policy/search",{params:e}),c=e=>n.Z.get(`/api/vm-service/policy/vmList/${e.policyId}`,{params:e}),r=e=>n.Z.post("/api/vm-service/policy",e),d=e=>n.Z.put(`/api/vm-service/policy/${e.policyId}`,e),g=e=>n.Z["delete"](`/api/vm-service/policy/${e.policyId}`,{params:e});var u={props:{tableData:{type:Array,required:!0},loading:{type:Boolean,default:!1}},methods:{handlePreview(e,t){this.$emit("handlePreview",e,t)},handleEdit(e,t){this.$emit("handleEdit",e,t)},async handleDelete(e,t){try{await this.$confirm("确定要删除吗？");try{await g({policyId:t.policyId,pageIndex:1,pageSize:10,policyName:t.policyName}),await this.$emit("getPolicyList"),this.$message.success("删除成功")}catch(a){this.$notify.info({title:"提示",iconClass:"message-icon",message:a.response.data})}}catch(i){console.log(i)}}}},m=u,y=a(1001),h=(0,y.Z)(m,o,s,!1,null,"3d2d1364",null),b=h.exports,v=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.title,visible:e.visible,width:"630px"},on:{close:e.closeFn}},["preview"!==e.type?t("el-form",{ref:"policyForm",attrs:{model:e.policyForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"策略名称：","label-width":"140px",prop:"policyName"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"10","show-word-limit":"","validate-event":!1},model:{value:e.policyForm.policyName,callback:function(t){e.$set(e.policyForm,"policyName",t)},expression:"policyForm.policyName"}})],1),t("el-form-item",{attrs:{label:"策略方案：","label-width":"140px",prop:"discount"}},[t("el-input-number",{staticStyle:{width:"396px"},attrs:{"controls-position":"right",min:0,max:100,placeholder:"请输入"},model:{value:e.policyForm.discount,callback:function(t){e.$set(e.policyForm,"discount",t)},expression:"policyForm.discount"}})],1)],1):e._e(),"preview"===e.type?[t("el-form",{staticClass:"preview"},[t("el-form-item",{attrs:{label:"策略名称：","label-width":"140px"}},[t("span",[e._v(e._s(e.currentRow.policyName))])]),t("el-form-item",{attrs:{label:"策略方案：","label-width":"140px"}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading1,expression:"loading1"}],attrs:{data:e.vmList}},[t("el-table-column",{attrs:{label:"序号",type:"index",index:1,width:"80"}}),t("el-table-column",{attrs:{label:"点位名称",width:"158",prop:"nodeName"}}),t("el-table-column",{attrs:{label:"设备编号",width:"158",prop:"innerCode"}})],1),t("div",{staticClass:"page"},[t("span",[e._v("共"+e._s(e.page.totalCount)+"条记录 第"+e._s(e.page.pageIndex)+"/"+e._s(e.page.totalPage)+"页")]),t("el-button-group",[t("el-button",{staticClass:"pre",class:{disable:"1"===e.page.pageIndex},attrs:{size:"small",disabled:"1"===e.page.pageIndex},on:{click:function(t){(e.page.pageIndex>1?e.page.pageIndex--:e.page.pageIndex)&&e.update()}}},[e._v("上一页")]),t("el-button",{staticClass:"next",class:{disable:e.page.pageIndex===e.page.totalPage},attrs:{size:"small",disabled:e.page.pageIndex===e.page.totalPage},on:{click:function(t){(e.page.pageIndex<e.page.totalPage?e.page.pageIndex++:e.page.pageIndex)&&e.update()}}},[e._v("下一页")])],1)],1)],1)],1)]:e._e(),"preview"!==e.type?t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"cancel",on:{click:e.closeFn}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确认")])],1):e._e()],2)},w=[],f={props:{visible:{type:Boolean,required:!0},type:{type:String,required:!0},loading1:{type:Boolean,default:!1},currentRow:{type:Object,required:!0},policyList:{type:Array,required:!0}},data(){return{policyForm:{policyName:"",discount:""},rules:{policyName:[{required:!0,message:"请输入策略名称："},{validator:(e,t,a)=>{let i=!1;i=this.policyForm.policyId?this.policyList.filter((e=>e.policyId!==this.policyForm.policyId)).some((e=>e.policyName===t)):this.policyList.some((e=>e.policyName===t)),i?a(new Promise(this.$message.error("已存在相同的合作商名称"))):a()}}],discount:[{required:!0,message:"请输入方案个数"}]},page:{pageIndex:1,pageSize:10,totalCount:0,totalPage:0},vmList:[],policyId:""}},created(){},computed:{title(){let e=null;return"preview"===this.type?e="策略详情":"add"===this.type?e="新增策略":"edit"===this.type&&(e="修改策略"),e}},methods:{closeFn(){"preview"!==this.type&&(this.policyForm={policyName:"",discount:""},this.$refs.policyForm.resetFields()),this.$emit("update:visible",!1)},async submit(){try{await this.$refs.policyForm.validate(),this.policyForm.policyId?(await d(this.policyForm),this.$message.success("修改成功")):(await r(this.policyForm),this.$message.success("新增成功")),this.closeFn(),this.$parent.getPolicyList()}catch(e){console.log(e)}},async getVmList(e){try{this.policyId=e,this.$emit("update:loading1",!0);const{currentPageRecords:t,pageIndex:a,pageSize:i,totalCount:l,totalPage:o}=await c({pageIndex:this.page.pageIndex,pageSize:this.page.pageSize,policyId:e});this.vmList=t,this.page={pageIndex:a,pageSize:i,totalCount:l,totalPage:o}}finally{this.$emit("update:loading1",!1)}},update(){this.getVmList(this.policyId)}}},x=f,I=(0,y.Z)(x,v,w,!1,null,"598c1a14",null),P=I.exports,_={components:{PMTable:b,PMDialog:P},data(){return{searchForm:{policyName:""},type:"",page:{pageIndex:1,pageSize:10,totalCount:0,totalPage:0},showDialog:!1,loading:!1,loading1:!1,policyList:[],currentRow:{}}},created(){this.getPolicyList()},methods:{async getPolicyList(e){try{this.loading=!0;let t={};t=e?await p({...e,pageIndex:this.page.pageIndex,pageSize:this.page.pageSize}):await p({pageIndex:this.page.pageIndex,pageSize:this.page.pageSize}),this.policyList=t.currentPageRecords,this.page.totalCount=t.totalCount,this.page.totalPage=t.totalPage}finally{this.loading=!1}},async handlePreview(e,t){this.type="preview",this.showDialog=!0,this.currentRow=t,this.$refs.pmDialog.getVmList(t.policyId)},handleEdit(e,t){this.type="edit",this.showDialog=!0,this.$refs.pmDialog.policyForm={policyId:t.policyId,policyName:t.policyName,discount:t.discount}},handleDelete(e,t){},cccc(){console.log("1")}}},F=_,$=(0,y.Z)(F,i,l,!1,null,"39dc330e",null),C=$.exports}}]);
//# sourceMappingURL=5.6a944064.js.map