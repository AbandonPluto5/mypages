"use strict";(self["webpackChunklikede"]=self["webpackChunklikede"]||[]).push([[730],{6730:function(e,t,a){a.r(t),a.d(t,{default:function(){return F}});var r=function(){var e=this,t=e._self._c;return t("div",[t("el-row",{staticClass:"search"},[t("el-col",{attrs:{span:24}},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"合作商搜索："}},[t("el-input",{staticStyle:{width:"203px"},attrs:{placeholder:"请输入",size:"medium",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"80px"},attrs:{icon:"el-icon-search",size:"medium"},on:{click:function(t){return e.getPartner(e.searchForm)}}},[e._v("查询")])],1)],1)],1)],1),t("el-row",{staticClass:"list"},[t("el-col",{attrs:{span:24}},[t("el-row",{staticClass:"add"},[t("el-col",[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline"},on:{click:function(t){(e.type="add")&&(e.showDialog=!0)}}},[e._v("新建")])],1)],1),t("el-row",{staticClass:"table"},[t("el-col",[t("NPTable",{attrs:{partnerList:e.partnerList,loading:e.loading},on:{handlePreview:e.handlePreview,handleEdit:e.handleEdit,handleDelete:e.handleDelete,resetPassword:e.resetPassword}})],1)],1),t("el-row",{staticClass:"page"},[t("el-col",{attrs:{span:20}},[t("span",[e._v("共"+e._s(e.page.totalCount)+"条记录  第 "+e._s(e.page.pageIndex)+"/"+e._s(e.page.totalPage)+" 页")])]),t("el-col",{attrs:{span:2}},[t("el-button",{class:{disable:1===e.page.pageIndex},attrs:{disabled:1===e.page.pageIndex},on:{click:function(t){(e.page.pageIndex>1?e.page.pageIndex--:e.page.pageIndex)&&e.getPartner()}}},[e._v("上一页")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{class:{disable:e.page.pageIndex===+e.page.totalPage},attrs:{disabled:e.page.pageIndex===+e.page.totalPage},on:{click:function(t){(e.page.pageIndex<e.page.totalPage?e.page.pageIndex++:e.page.pageIndex)&&e.getPartner()}}},[e._v("下一页")])],1)],1)],1)],1),t("NPDialog",{ref:"npDialog",attrs:{visible:e.showDialog,type:e.type,partnerList:e.partnerList,currentRow:e.currentRow},on:{"update:visible":function(t){e.showDialog=t}}})],1)},n=[],o=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.partnerList,"empty-text":"","cell-style":{padding:"2px 0",border:"none"},size:"small","header-cell-style":{background:"#f4f6fa"}}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"80"}}),t("el-table-column",{attrs:{label:"合作商名称","min-width":"137",prop:"name"}}),t("el-table-column",{attrs:{label:"账号","min-width":"132",prop:"account"}}),t("el-table-column",{attrs:{label:"设备数量","min-width":"132",prop:"vmCount"}}),t("el-table-column",{attrs:{label:"分成比例","min-width":"132",prop:"ratio",formatter:e.formatRatio}}),t("el-table-column",{attrs:{label:"联系人","min-width":"132",prop:"contact"}}),t("el-table-column",{attrs:{label:"联系电话","min-width":"132",prop:"mobile"}}),t("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.resetPassword(a.$index,a.row)}}},[e._v("重置密码")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handlePreview(a.$index,a.row)}}},[e._v("查看详情")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("修改")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}},[e._v("删除")])]}}])})],1)},l=[],i=a(4535),s={props:{loading:{type:Boolean,default:!1},partnerList:{type:Array,required:!0}},methods:{resetPassword(e,t){this.$confirm("确定要重置合作商密码吗？",{type:"warning",showClose:!1}).then((async()=>{await(0,i.pt)(t.id),this.$message.success("重置成功")})).catch((e=>{console.log(e)}))},handlePreview(e,t){this.$emit("handlePreview",e,t)},handleEdit(e,t){this.$emit("handleEdit",e,t)},async handleDelete(e,t){try{await this.$confirm("确定要删除吗？"),this.$emit("handleDelete",e,t)}catch(a){console.log(a)}},formatRatio(e,t,a,r){return a+"%"}}},p=s,c=a(1001),d=(0,c.Z)(p,o,l,!1,null,"4c4cb71a",null),m=d.exports,u=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.title,visible:e.visible,width:"630px"},on:{close:e.closeFn}},["preview"!==e.type?t("el-form",{ref:"partnerForm",attrs:{model:e.partnerForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"合作商名称：","label-width":"140px",prop:"name"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"10","show-word-limit":"","validate-event":!1},model:{value:e.partnerForm.name,callback:function(t){e.$set(e.partnerForm,"name",t)},expression:"partnerForm.name"}})],1),t("el-form-item",{attrs:{label:"联系人：","label-width":"140px",prop:"contact"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"10","show-word-limit":"","validate-event":!1},model:{value:e.partnerForm.contact,callback:function(t){e.$set(e.partnerForm,"contact",t)},expression:"partnerForm.contact"}})],1),t("el-form-item",{attrs:{label:"联系电话：","label-width":"140px",prop:"mobile"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"11","show-word-limit":"","validate-event":!1},model:{value:e.partnerForm.mobile,callback:function(t){e.$set(e.partnerForm,"mobile",t)},expression:"partnerForm.mobile"}})],1),t("el-form-item",{attrs:{label:"分成比例(%)：","label-width":"140px",prop:"ratio"}},[t("el-input-number",{staticStyle:{width:"396px"},attrs:{"controls-position":"right",min:0,max:100,placeholder:"请输入"},model:{value:e.partnerForm.ratio,callback:function(t){e.$set(e.partnerForm,"ratio",t)},expression:"partnerForm.ratio"}})],1),"add"===e.type?t("el-form-item",{attrs:{label:"账号：","label-width":"140px",prop:"account"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"18","show-word-limit":"","validate-event":!1},model:{value:e.partnerForm.account,callback:function(t){e.$set(e.partnerForm,"account",t)},expression:"partnerForm.account"}})],1):e._e(),"add"===e.type?t("el-form-item",{attrs:{label:"密码：","label-width":"140px",prop:"password"}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入",maxlength:"20","show-word-limit":"","validate-event":!1},model:{value:e.partnerForm.password,callback:function(t){e.$set(e.partnerForm,"password",t)},expression:"partnerForm.password"}})],1):e._e()],1):e._e(),"preview"===e.type?[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form",[t("el-form-item",{attrs:{label:"合作商名称：","label-width":"140px"}},[t("span",[e._v(e._s(e.currentRow.name))])])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form",[t("el-form-item",{attrs:{label:"联系人：","label-width":"140px"}},[t("span",[e._v(e._s(e.currentRow.contact))])])],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form",[t("el-form-item",{attrs:{label:"联系电话：","label-width":"140px"}},[t("span",[e._v(e._s(e.currentRow.mobile))])])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form",[t("el-form-item",{attrs:{label:"分成比例：","label-width":"140px"}},[t("span",[e._v(e._s(e.currentRow.ratio+"%"))])])],1)],1)],1)]:e._e(),"preview"!==e.type?t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"cancel",on:{click:e.closeFn}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确认")])],1):e._e()],2)},h=[],g={props:{visible:{type:Boolean,required:!0},type:{type:String,required:!0},loading:{type:Boolean,default:!1},partnerList:{type:Array,required:!0},currentRow:{type:Object,required:!0}},data(){return{partnerForm:{name:"",account:"",password:"",ratio:"",contact:"",mobile:""},rules:{name:[{required:!0,message:"请输入合作商名称"},{validator:(e,t,a)=>{let r=!1;r=this.partnerForm.id?this.partnerList.filter((e=>e.id!==this.partnerForm.id)).some((e=>e.name===t)):this.partnerList.some((e=>e.name===t)),r?a(new Promise(this.$message.error("已存在相同的合作商名称"))):a()}}],contact:[{required:!0,message:"请输入联系人"}],mobile:[{required:!0,message:"请输入联系电话"},{pattern:/^1\d{10}$/,message:"手机号必须是11位纯数字"}],ratio:[{required:!0,message:"请输入分成比例"}],account:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}]}}},created(){},computed:{title(){let e=null;return"preview"===this.type?e="合作商详情":"add"===this.type?e="新增合作商":"edit"===this.type&&(e="修改合作商"),e}},methods:{closeFn(){"preview"!==this.type&&(this.partnerForm={name:"",account:"",password:"",ratio:"",contact:"",mobile:""},this.$refs.partnerForm.resetFields()),this.$emit("update:visible",!1)},async submit(){try{await this.$refs.partnerForm.validate(),this.partnerForm.id?(console.log(this.partnerForm.id),await(0,i.IP)(this.partnerForm),this.$message.success("修改成功")):(await(0,i.Of)(this.partnerForm),this.$message.success("新增成功")),this.closeFn(),this.$parent.getPartner()}catch(e){console.log(e)}}}},f=g,w=(0,c.Z)(f,u,h,!1,null,"07e43b22",null),b=w.exports,v={components:{NPTable:m,NPDialog:b},data(){return{searchForm:{name:""},type:"",page:{pageIndex:1,pageSize:10,totalCount:0,totalPage:0},showDialog:!1,loading:!1,partnerList:[],currentRow:{}}},created(){this.getPartner()},methods:{async getPartner(e){try{this.loading=!0;let t={};t=e?await(0,i.k)({pageIndex:this.page.pageIndex,pageSize:this.page.pageSize,name:e.name}):await(0,i.k)({pageIndex:this.page.pageIndex,pageSize:this.page.pageSize}),this.partnerList=t.currentPageRecords,this.page.totalPage=t.totalPage,this.page.totalCount=t.totalCount}finally{this.loading=!1}},resetPassword(e,t){},handleEdit(e,t){console.log(t),this.type="edit",this.showDialog=!0,this.$refs.npDialog.partnerForm={account:t.account,contact:t.contact,mobile:t.mobile,name:t.name,password:t.password,ratio:t.ratio,id:t.id}},handlePreview(e,t){this.type="preview",this.showDialog=!0,this.currentRow=t},async handleDelete(e,t){try{await(0,i.Sj)({id:t.id,name:t.name,pageIndex:this.page.pageIndex,pageSize:this.page.pageSize})}catch(a){console.log(a),this.$notify.info({title:"提示",iconClass:"message-icon",message:a.response.data})}}}},x=v,y=(0,c.Z)(x,r,n,!1,null,"d5dfbf2c",null),F=y.exports},4535:function(e,t,a){a.d(t,{H:function(){return g},IP:function(){return w},Of:function(){return f},Oq:function(){return i},Sj:function(){return b},WI:function(){return c},gz:function(){return m},iw:function(){return n},k:function(){return d},pt:function(){return v},tQ:function(){return p},tV:function(){return u},wo:function(){return h},xS:function(){return o},zO:function(){return s},zl:function(){return l}});var r=a(471);const n=()=>r.Z.get("/api/vm-service/node/nodeCollect"),o=e=>r.Z.get("/api/vm-service/region/search",{params:e}),l=e=>r.Z.post("/api/vm-service/region",e),i=e=>r.Z.put(`/api/vm-service/region/${e.id}`,e),s=e=>r.Z["delete"](`/api/vm-service/region/${e}`),p=e=>r.Z.get("/api/vm-service/node/search",{params:e}),c=()=>r.Z.get("/api/vm-service/businessType"),d=e=>r.Z.get("/api/user-service/partner/search",{params:e}),m=e=>r.Z.post("/api/vm-service/node",e),u=e=>(0,r.Z)({method:"PUT",url:`/api/vm-service/node/${e.id}`,data:e}),h=e=>r.Z["delete"](`/api/vm-service/node/${e.id}`,{params:e}),g=e=>r.Z.get(`/api/vm-service/node/vmList/${e}`),f=e=>r.Z.post("/api/user-service/partner",e),w=e=>r.Z.put(`/api/user-service/partner/${e.id}`,e),b=e=>r.Z["delete"](`/api/user-service/partner/${e.id}`,{params:e}),v=e=>r.Z.put(`/api/user-service/partner/resetPwd/${e}`)}}]);
//# sourceMappingURL=730.c84042a9.js.map